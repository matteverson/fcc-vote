<div ng-include="'components/navbar/navbar.html'"></div>
<div class="col-md-12">
  <h1>My polls</h1>
  <div class="col-md-4 col-lg-4 col-sm-6 well">
    <div ng-repeat="poll in polls" ng-click="setEditedPoll(poll)" ng-class="{'active':isCurrentPoll(poll._id)}">
      <button type="button" class="close" ng-click="deletePoll(poll._id)">&times;</button>
      <h3>{{poll.name}}</h3>
    </div>
  </div>
  <div class="col-md-8">
    <!-- CREATE ITEM FORM -->
    <form class="form" name="form" ng-if="!isEditing" ng-submit="addPoll(form)" novalidate>

      <div class="form-group" ng-class="{ 'has-success': form.name.$valid && submitted,
                                          'has-error': form.name.$invalid && submitted }">
        <label>Name</label>

        <input type="text" name="name" class="form-control" ng-model="newPoll.name"
               required/>
        <p class="help-block" ng-show="form.name.$error.required && submitted">
          A name is required
        </p>
      </div>

      <div class="form-group" ng-repeat="option in newPoll.options" ng-class="{ 'has-success': optionForm.option.$valid && submitted,
                                          'has-error': optionForm.option.$invalid && submitted }">
        <ng-form name="optionForm">
        <label>Option {{$index+1}}</label>

        <input type="text" name="option" class="form-control" ng-model="option.name"
               required
               mongoose-error/>
        <button class="btn btn-danger" ng-click="removeOption(option)">Delete</button>
        <p class="help-block" ng-show="optionForm.option.$invalid">
          The option cannot be empty
        </p>
        <p class="help-block" ng-show="optionForm.option.$error.mongoose">
          {{ errors.email }}
        </p>
      </ng-form>
      </div>

      <div>
        <button class="btn btn-primary btn-lg" type="submit">Create</button>
        <button class="btn btn-inverse btn-lg" ng-click="addOption()">Add option</button>
      </div>
    </form>
    <!-- EDIT ITEM FORM -->

    <form class="form" name="form" ng-if="isEditing" ng-submit="updatePoll(form)" novalidate>

      <div class="form-group" ng-class="{ 'has-success': form.name.$valid && submitted,
                                          'has-error': form.name.$invalid && submitted }">
        <label>Name</label>

        <input type="text" name="name" class="form-control" ng-model="editedPoll.name"
               required/>
        <p class="help-block" ng-show="form.name.$error.required && submitted">
          A name is required
        </p>
      </div>

      <div class="form-group" ng-repeat="option in editedPoll.options" ng-class="{ 'has-success': optionForm.option.$valid && submitted,
                                          'has-error': optionForm.option.$invalid && submitted }">
        <ng-form name="optionForm">
        <label>Option {{$index+1}}</label>

        <input type="text" name="option" class="form-control" ng-model="option.name"
               required
               mongoose-error/>
        <button class="btn btn-danger" ng-click="removeOption(option)">Delete</button>
        <p class="help-block" ng-show="optionForm.option.$invalid">
          The option cannot be empty
        </p>
        <p class="help-block" ng-show="optionForm.option.$error.mongoose">
          {{ errors.email }}
        </p>
      </ng-form>
      </div>
      <button type="submit" class="btn btn-info btn-lg">Save</button>
      <button type="button" class="btn btn-default btn-lg pull-right" ng-click="cancelEditing()">Cancel</button>
      <button class="btn btn-inverse btn-lg" ng-click="addOption()">Add option</button>
    </form>
  </div>
</div>
